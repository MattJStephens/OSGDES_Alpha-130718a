//////////////////////////////////////////////////////////////////////
//	MJim - Alpha
//	Stephens Atomics 
//	Copyright (C) 2013  Matthew James Stephens, B.Eng- Robotics(Hons)
//
//	This program is free software: you can redistribute it and/or modify
//	it under the terms of the GNU General Public License as published by
//	the Free Software Foundation, either version 3 of the License, or
//	(at your option) any later version.
//	This program is distributed in the hope that it will be useful,
//	but WITHOUT ANY WARRANTY; without even the implied warranty of
//	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//	GNU General Public License for more details.
//	<http://www.gnu.org/licenses/>   
//////////////////////////////////////////////////////////////////////

#include "OSG_Camera.h"

CCustomCamera::CCustomCamera()
{	
	m_up_axis= NavigateUpAxisX;
	m_velocity_coefficient = 2;
	m_mouse_coefficient = 0.001;	
	m_position.set(0,0,0);
	m_yaw= 0;
	m_pitch= 0;
	m_roll= 0;
}

void CCustomCamera::intialise(void)
{
	m_file_name = "cam_pos.txt";
	//m_debug_ofs.open(m_file_name, std::ios_base::out | std::ios_base::app);
}

osg::Matrixd CCustomCamera::update_position(float delta_t, osg::Matrixd CameraInvMatrix)
{
	osg::Vec4d worldSpaceCameraPosition = CameraInvMatrix * osg::Vec4d(0,0,0,1);//you can use just translation column(or row?) of matrix instead 
	osg::Vec3d vec;
	vec.set(m_x, m_y, m_z);						
	m_velocity = osg::Matrixd::transform3x3(CameraInvMatrix, vec);
	m_position += (m_velocity* m_velocity_coefficient);
	m_cameraTrans = osg::Matrix::translate(m_position);
	m_yaw+= (m_delta_mouse_x* m_mouse_coefficient);
	while(m_yaw> (2*osg::PI)){ m_yaw -= (2*osg::PI);}
	while(m_yaw< -(2*osg::PI)){ m_yaw += (2*osg::PI);}
	m_pitch-= (m_delta_mouse_y* m_mouse_coefficient);
	while(m_pitch> osg::PI){ m_pitch -= osg::PI;}
	while(m_pitch< -osg::PI){ m_pitch += osg::PI;}	
	float m_roll = 0;
	switch(m_up_axis)
	{
		case NavigateUpAxisX:
		{
			osg::Quat quat(m_roll, osg::Z_AXIS, m_yaw, osg::Y_AXIS, m_pitch, osg::X_AXIS);	
			m_cameraRotation = osg::Matrix::rotate(quat);			
			osg::Matrixd modify = osg::Matrix::rotate(-osg::PI_2,osg::X_AXIS);	
			m_CameraMatrix = m_cameraTrans * (modify *m_cameraRotation);
			break;
		}
		case NavigateUpAxisY:
		{
			osg::Quat quat(m_roll, osg::Z_AXIS, m_yaw, osg::Y_AXIS, m_pitch, osg::X_AXIS);	
			m_cameraRotation = osg::Matrix::rotate(quat);			
			m_CameraMatrix = m_cameraTrans * m_cameraRotation;
			break;
		}
		default:
		{			
			osg::Quat quat(m_roll, osg::Z_AXIS, m_yaw, osg::Y_AXIS, m_pitch, osg::X_AXIS);	
			m_cameraRotation = osg::Matrix::rotate(quat);			
			m_CameraMatrix = m_cameraTrans * m_cameraRotation;
			break;
		}
	}	
	return m_CameraMatrix;
}

/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~==~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=++=+++~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=+==~==+=~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~===~~~~~~~:~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=+=~~~~::::~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+=~~~~:::~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~==~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=+:~~:::~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~==+===~~~~~~~~~~~~~~~~~~~~~~~~==+++++==~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=+=.,:::~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~+?I???+++==~~~~~~~~~~~~~~~~~~~~~~~=====+===~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+~,,,,:~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~====+++??III?++++==~~~::~~~~~~~~~~~:~~~====+==~~~~~~~~~~~~~~~~~~~~~~~~~=:.,,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~===+++?II7$7?+==~~~:::~~~~~~~:~~~===++==~~~~~~~~~~~~~~~~~~~~~...~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~===++?II7ZZZI==~~:::~~~~::~~===++=~~~~~~~~~~~~~~~~~..:~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~=Z?+=~~~~~~~~~~~~==++?II$ZZZZ7+:::,,~::~~~=?+==~~~~~~~~~~=~.,~=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~:O8Z7~~~~~~~~~~~~~~~~~==++?7ZZZZOZOZOI??:=+?=~=~~~~~?I.~=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~ZOOZ?~~~~~~~~~~~~~~~~~~~~~~~=+I7=~~=?7Z$~Z+DOZ=I,7ZI=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~$OOZZ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~::,IN7$87NI~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~:O$OZI~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~:,I?7NNN~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~OODZOI~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+$O.=DD$~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~===~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~OOOIZO?~~~~~~~~~~~~~~~~~~~~~~~~~~~~~,:$7,,Z?DOD=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~::~~~======+++????+~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~Z$$$8O7~~~~~~~~~~~~~~~~~~~~~~~~~~~::=7ZI=:8OI+$~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~:::~~~~===++???IIIIIIIII????+=~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~=:OOOZ8Z+~~~~~~~~~~~~~~~~~~~~~~~~,::I7$7+=~IIDD8N~~~~~~~~~~~~~~~~~~~~=++===+?7ZZZZZ$$7II???++========~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~OOOOZZ$=~~~~~~~~~~~~~~~~~~~=~I==+$$I+=~~~?$8DO:~=~=~::I7$$ZOO8OOZZZZZOZZ$II?+===~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~$OOZZO$I+=~~~~:~~~~~~~~~~=+===+7Z$?=~~~~~~D8IZZ7?IIZZDD87+~~~7O$I?+==I~7OI~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~:OOZZZOO$II?~~~$N~~~~~~~~~:=++$ZO8=~~~~~~$+?Z8?I=...==~~~~~~~~~~~~~~~Z$O7$$77?~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~OOZZZO8OZZ$7??IIN=++7?+:~~+7$I?I?+=??Z8DI.ODI$Z~=ZO+??+??+~~~~~~~~~=+I7$8888?~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~:ZZO8O7Z$$$$7$ZZOO$?????ZZOOO7::?Z$Z88OZOODID?O+?I$OOOOO8=~~~=IZOOO:~~:~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~,7OZ$+???77$77++?III7I+::+~?77?8O+$Z88M8M~OZ~~~=:7$ZN?O8OI??$888D8I~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~::~~~~=~IZ=7II7=?7~?7II?II?7?????ZO~=+==+?=~~=~~+??+D8DIDZ~~8888ZO~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~=888+ZZZ$8Z7~:$I+77$777778II?+?+OO$+++?+=?ZI+++7?+?===++ZN88O$8788$$O,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~DDDD8=~~===Z8OZ$ZOZZ$$,?,Z$I?Z$8Z??+?+Z$?ZZZZZO+=~+++7+8~+?D8=~~~+~~=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~==+=+~~:~~~$O88O8D+8O$OND$.OZZOZ8$77I$~$+ZIZO$$77O7Z7+=Z=OZOI=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~===~~~~=+$8~~~~~~=~88888OO8DN?+IZ88OOOZO$7DNOZOD7O7777Z8ZD8$IZZ$I?$+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~=+~~~~~~:~=~DDN=~~~~~~~~~~888O8DOOZZOD8O88OZO88DNNNOOZ777$ZZ$DDZ8Z7ZZ$$$=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~=+====~~~:~~~~~~~~~~~~~~~~~~~~~~~7OO$8OD88D8DD888DDD7NNNOIO88$?$8Z8DZZD8~ZOZ=O$~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~=+++=+===~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~$OOZOZ~:?O8Z78D8DDD8O~~ZOOOOO$IOZZ888ZZOO8OO88=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+I:==?$8888NNDD8DDO?=:+7Z8888O$7?+++8OOOZZZOOO$~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=I~==~=D$O88DDNNNDN888ODD8O7?ZDN88O$N888888OZ$$$ZOOO7~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~7=:~~~~~?~:::?88D8888IDDDDNDNNNNDDDD8OONDON8ZONDDNDDD88OOOO8OZ7D:??:~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=O778~?~~~78OO~+DD888O88DN8DNDDDDD888ODNDNDONOOD8ZZZ$7I?++IDDNDDO==~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~OZZZI+~=~7O7$OO8~~~~~~~~~~~:~I$::~ZDZ8NN8DDDDOZ8OOOOOOZZI?DDND8:~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~OOO888O8~,88$OOZI7~=~~~~~~~~~~~~~~~~~~~~~~~~:IOZZZOZOOOOO8OOZDZ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=~~~~~=~7,~~=I8IZ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~IOOOZI:888~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~:::~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Matthew James Stephens 2011~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~,~...~~~,~,..,:~~..~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 */
